<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∂‡§ø‡§µ‡§∞‡§æ‡§ú ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ - ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä</title>
	
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	
	    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mukta:wght@400;600;700&display=swap">
	<link href="https://nepali-datepicker.s3.ap-south-1.amazonaws.com/nepali.datepicker.v4.0.1.min.css" rel="stylesheet" type="text/css">
	<script src="https://nepali-datepicker.s3.ap-south-1.amazonaws.com/nepali.datepicker.v4.0.1.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
body { font-family: 'Mukta', sans-serif; transition: all 0.3s; }
  .sidebar-transition { transition: width 0.3s ease-in-out; }
  .hidden-text { display: none; }
  
</style>
</head>

<body class="bg-gray-100 flex h-screen overflow-hidden">

<aside id="sidebar" class="sidebar-transition w-64 bg-[#f8fafc] text-slate-700 flex flex-col border-r border-slate-200 relative">
    <div class="p-4 bg-[#dee2e6] flex items-center space-x-2 border-b border-slate-300">
        <span class="text-2xl">üè†</span>
        <span class="font-bold text-lg text-blue-900 sidebar-text">Smart-Sewa</span>
    </div>
    
    <nav class="flex-1 mt-2 overflow-y-auto custom-scrollbar">
        <a href="javascript:void(0)" onclick="showView('dashboard')" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-700 transition font-semibold" id="nav-dashboard">
            <span class="text-xl">üìä</span> <span class="ml-4 sidebar-text">‡§°‡•ç‡§Ø‡§æ‡§∏‡§¨‡•ã‡§∞‡•ç‡§°</span>
        </a>

        <a href="javascript:void(0)" onclick="showView('registration')" class="flex items-center px-6 py-3 hover:bg-blue-50 hover:text-blue-700 transition" id="nav-reg">
            <span class="text-xl">‚úîÔ∏è</span> <span class="ml-4 sidebar-text">‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¶‡§∞‡•ç‡§§‡§æ</span>
        </a>

        <div class="px-6 py-2 text-xs font-bold text-slate-400 uppercase sidebar-text">‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</div>
        
        <a href="javascript:void(0)" onclick="showView('implementation')" class="flex items-center px-6 py-3 hover:bg-blue-50 transition justify-between" id="nav-imp">
    <div class="flex items-center">
        <span class="text-xl">üóÑÔ∏è</span> 
        <span class="ml-4 sidebar-text">‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§û‡•ç‡§ö‡§æ‡§≤‡§®</span>
    </div>
    <span class="text-[10px] sidebar-text">‚óÄ</span>
</a>

        <a href="javascript:void(0)" onclick="showView('dashboard')" class="flex items-center px-6 py-3 hover:bg-blue-50 transition">
            <span class="text-xl">‚úÖ</span> <span class="ml-4 sidebar-text">‡§∏‡§Æ‡•ç‡§™‡§®‡•ç‡§® ‡§Ø‡•ã‡§ú‡§®‡§æ</span>
        </a>

        <a href="#" class="flex items-center px-6 py-3 hover:bg-blue-50 transition">
            <span class="text-xl">üìà</span> <span class="ml-4 sidebar-text">‡§ó‡§§ ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑</span>
        </a>
    </nav>
</aside>

    <div class="flex-1 flex flex-col overflow-hidden">
        <header class="h-16 bg-blue-700 text-white shadow-md flex items-center justify-between px-6">
            <div class="flex items-center">
                <button onclick="toggleSidebar()" class="text-2xl p-2 hover:bg-blue-600 rounded-lg mr-4">‚ò∞</button>
                <h2 class="font-bold text-lg hidden md:block">‡§∂‡§ø‡§µ‡§∞‡§æ‡§ú ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ-‡§Ø‡•ã‡§ú‡§®‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</h2>
            </div>
            <div class="flex items-center space-x-4">
                <span id="userEmail" class="text-xs font-bold text-blue-100">‡§≤‡•ã‡§° ‡§π‡•Å‡§Å‡§¶‡•à...</span>
                <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded font-bold text-xs">Log out</button>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-6 relative">
            
            <div id="view-dashboard">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-emerald-600 text-white p-6 rounded shadow-lg flex items-center justify-between">
                        <div><p class="text-xs opacity-80 uppercase">‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ</p><h2 id="totalCount" class="text-3xl font-bold">...</h2></div>
                        <span class="text-4xl opacity-30">üèõÔ∏è</span>
                    </div>
                    <div class="bg-blue-600 text-white p-6 rounded shadow-lg flex items-center justify-between">
                        <div><p class="text-xs opacity-80 uppercase">‡§∏‡§û‡•ç‡§ö‡§æ‡§≤‡§®‡§Æ‡§æ ‡§∞‡§π‡•á‡§ï‡•ã</p><h2 class="text-3xl font-bold">‡•¶</h2></div>
                        <span class="text-4xl opacity-30">üë•</span>
                    </div>
                    <div class="bg-purple-600 text-white p-6 rounded shadow-lg flex items-center justify-between">
                        <div><p class="text-xs opacity-80 uppercase">‡§∏‡§Æ‡•ç‡§™‡§®‡•ç‡§® ‡§≠‡§è‡§ï‡•ã</p><h2 class="text-3xl font-bold">‡•¶</h2></div>
                        <span class="text-4xl opacity-30">‚úÖ</span>
                    </div>
                    <div class="bg-slate-500 text-white p-6 rounded shadow-lg flex items-center justify-between">
                        <div><p class="text-xs opacity-80 uppercase">‡§Æ‡•ç‡§Ø‡§æ‡§¶ ‡§•‡§™ ‡§≠‡§è‡§ï‡•ã</p><h2 class="text-3xl font-bold">‡•¶</h2></div>
                        <span class="text-4xl opacity-30">‚è≥</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded shadow border"><h3 class="text-center font-bold border-b mb-4 pb-2">‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§∏‡§Æ‡•ç‡§ù‡•å‡§§‡§æ</h3><canvas id="barChart"></canvas></div>
                    <div class="bg-white p-4 rounded shadow border flex flex-col items-center"><h3 class="text-center font-bold border-b mb-4 pb-2 w-full">‡§µ‡§ø‡§®‡§ø‡§Ø‡•ã‡§ú‡§® ‡§ï‡§ø‡§∏‡§ø‡§Æ</h3><div class="w-64"><canvas id="pieChart"></canvas></div></div>
                </div>
            </div>

            <div id="view-registration" class="hidden">
                <div class="bg-white rounded-lg shadow-lg border p-4">
                    <div class="flex justify-between items-center mb-6 border-b pb-4">
                        <h3 class="text-xl font-bold text-gray-700">üìã ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ/‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¶‡§∞‡•ç‡§§‡§æ ‡§∏‡•Ç‡§ö‡•Ä</h3>
                        <button onclick="openModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow-lg hover:bg-blue-700">+ ‡§®‡§Ø‡§æ‡§Å ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                    </div>
<div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-8 gap-2 mb-4 bg-gray-50 p-3 border rounded shadow-sm items-end">
    <div>
        <label class="block mb-1 font-medium" style="font-size: 15px;">‡§Æ‡§ø‡§§‡§ø ‡§¶‡•á‡§ñ‡§ø</label>
        <input type="text" id="nepali-datepicker-from" class="border rounded px-2 py-2 w-full" style="font-size: 15px;" placeholder="‡•®‡•¶‡•Æ‡•ß-‡•¶‡•ß-‡•¶‡•ß">
    </div>
    <div>
        <label class="block mb-1 font-medium" style="font-size: 15px;">‡§Æ‡§ø‡§§‡§ø ‡§∏‡§Æ‡•ç‡§Æ</label>
        <input type="text" id="nepali-datepicker-to" class="border rounded px-2 py-2 w-full" style="font-size: 15px;" placeholder="‡•®‡•¶‡•Æ‡•ß-‡•ß‡•®-‡•©‡•¶">
    </div>
    <div class="col-span-1 md:col-span-2">
        <label class="block mb-1 font-medium" style="font-size: 15px;">‡§ñ‡•ã‡§ú‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</label>
        <input type="text" id="searchProject" oninput="loadProjectData()" class="border rounded px-2 py-2 w-full" style="font-size: 15px;" placeholder="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ/‡§Ø‡•ã‡§ú‡§®‡§æ/‡§ï‡•ã‡§° ‡§®‡§Ç.">
    </div>
    <div>
        <label class="block mb-1 font-medium" style="font-size: 15px;">‡§µ‡§°‡§æ ‡§®‡§Ç.</label>
        <select id="wardFilter" onchange="loadProjectData()" class="border rounded px-2 py-2 w-full bg-white" style="font-size: 15px;">
            <option value="">‡§∏‡§¨‡•à ‡§µ‡§°‡§æ ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
            <option value="0">‡§™‡§æ‡§≤‡§ø‡§ï‡§æ</option>
            <option value="1">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•ß</option>
            <option value="2">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•®</option>
            <option value="3">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•©</option>
            <option value="4">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•™</option>
            <option value="5">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•´</option>
            <option value="6">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•¨</option>
            <option value="7">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•≠</option>
            <option value="8">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•Æ</option>
            <option value="9">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•Ø</option>
            <option value="10">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•ß‡•¶</option>
            <option value="11">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡•ß‡•ß</option>
        </select>
    </div>
    <select class="border rounded px-2 py-2 bg-white" style="font-size: 15px;"><option>‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞</option></select>
    <select class="border rounded px-2 py-2 bg-white" style="font-size: 15px;"><option>‡§µ‡§ø‡§®‡§ø‡§Ø‡•ã‡§ú‡§®</option></select>
    <select class="border rounded px-2 py-2 bg-white" style="font-size: 15px;"><option>‡§ñ‡§∞‡§ø‡§¶ ‡§µ‡§ø‡§ß‡§ø</option></select>
</div>

<div class="flex justify-between items-center mb-4">
    <div class="flex items-center space-x-2">
        <span style="font-size: 15px;" class="text-gray-600">Show</span>
        <select id="entriesPerPage" onchange="updateEntries()" class="border rounded px-2 py-1 bg-white shadow-sm" style="font-size: 15px;">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select>
        <span style="font-size: 15px;" class="text-gray-600">entries</span>
    </div>

    <div class="flex space-x-2">
        <button onclick="exportToExcel()" class="p-2 border rounded bg-white text-green-600 hover:bg-gray-100 shadow-sm" style="font-size: 18px;" title="Download Excel">
            <i class="fas fa-file-download"></i>
        </button>
        <button onclick="printData()" class="p-2 border rounded bg-white text-orange-600 hover:bg-gray-100 shadow-sm" style="font-size: 18px;" title="Print">
            <i class="fas fa-print"></i>
        </button>
    </div>
</div>

<table id="projectTable" class="min-w-full bg-white border-collapse text-left">
    <thead>
        <tr class="bg-blue-50 text-blue-800 uppercase" style="font-size: 15px;">
            <th class="px-4 py-3 border">‡§ï‡•ã‡§° ‡§®‡§Ç.</th>
            <th class="px-4 py-3 border">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ/‡§Ø‡•ã‡§ú‡§®‡§æ‡§ï‡•ã ‡§®‡§æ‡§Æ</th>
            <th class="px-4 py-3 border text-center">‡§µ‡§°‡§æ</th>
            <th class="px-4 py-3 border text-right">‡§µ‡§ø‡§®‡§ø‡§Ø‡•ã‡§ú‡§® ‡§∞‡§ï‡§Æ</th>
            <th class="px-4 py-3 border text-center">‡§ñ‡§∞‡•ç‡§ö ‡§∞‡§ï‡§Æ</th>
            <th class="px-4 py-3 border text-center">‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ</th>
            <th class="px-4 py-3 border text-center">‡§ï‡§æ‡§∞‡•ç‡§Ø</th>
        </tr>
    </thead>
    <tbody id="projectTableBody" style="font-size: 15px;" class="text-gray-700"></tbody>
</table>

<div id="paginationControls" class="mt-4 flex justify-between items-center px-4 pb-4 border-t pt-4" style="font-size: 15px;">
</div>

            <div id="registrationModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl overflow-hidden">
<div id="modalHeader" class="bg-blue-700 px-6 py-3 flex justify-between items-center text-white cursor-move">
    <h3 class="font-bold">‡§®‡§Ø‡§æ‡§Å ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¶‡§∞‡•ç‡§§‡§æ</h3>
    <button onclick="closeModal()" class="text-white hover:text-gray-200 text-2xl">&times;</button>
</div>
	
                    <form id="projectForm" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <label class="block mb-1 font-bold">‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑ (FY)</label>
                            <select id="form_FY" class="w-full border p-2 rounded bg-gray-50"><option>2082/83</option><option>2081/82</option></select>
                        </div>
                        <div>
                            <label class="block mb-1 font-bold">‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ (Sector)</label>
                            <select id="form_Sector" class="w-full border p-2 rounded">
                                <option value="">‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option><option>‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§ß‡§æ‡§∞ ‡§µ‡§ø‡§ï‡§æ‡§∏</option><option>‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§ø‡§ï‡§æ‡§∏</option><option>‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§µ‡§ø‡§ï‡§æ‡§∏</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-1 font-bold">‡§µ‡§ø‡§®‡§ø‡§Ø‡•ã‡§ú‡§® ‡§ï‡§ø‡§∏‡§ø‡§Æ</label>
                            <select id="form_Type" class="w-full border p-2 rounded">
                                <option value="">‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option><option>‡§™‡•Å‡§Å‡§ú‡•Ä‡§ó‡§§</option><option>‡§ö‡§æ‡§≤‡•Å</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-1 font-bold">‡§µ‡§°‡§æ ‡§®‡§Ç.</label>
                            <select id="form_Ward_No" class="w-full border p-2 rounded">
                                <option value="">‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option><option value="1">‡•ß</option><option value="2">‡•®</option><option value="3">‡•©</option><option value="4">‡•™</option>
                                <option value="5">‡•´</option><option value="6">‡•¨</option><option value="7">‡•≠</option><option value="8">‡•Æ</option><option value="9">‡•Ø</option>
                                <option value="10">‡•ß‡•¶</option><option value="11">‡•ß‡•ß</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block mb-1 font-bold">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ/‡§Ø‡•ã‡§ú‡§®‡§æ‡§ï‡•ã ‡§®‡§æ‡§Æ</label>
                            <input type="text" id="form_Yojana_Name" class="w-full border p-2 rounded" placeholder="‡§Ø‡•ã‡§ú‡§®‡§æ‡§ï‡•ã ‡§®‡§æ‡§Æ" required>
                        </div>
                        <div>
                            <label class="block mb-1 font-bold">‡§µ‡§ø‡§®‡§ø‡§Ø‡•ã‡§ú‡§® ‡§∞‡§ï‡§Æ</label>
                            <input type="number" id="form_Budget" class="w-full border p-2 rounded" placeholder="0.00" required>
                        </div>
                        <div>
                            <label class="block mb-1 font-bold">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§Ø‡§® ‡§π‡•Å‡§®‡•á ‡§∏‡•ç‡§•‡§æ‡§®</label>
                            <input type="text" id="form_Location" class="w-full border p-2 rounded" placeholder="‡§ó‡§æ‡§â‡§Å ‡§µ‡§æ ‡§ü‡•ã‡§≤">
                        </div>
                        <div class="md:col-span-2 flex justify-end space-x-3 mt-4 border-t pt-4">
                            <button type="button" onclick="clearForm()" class="px-6 py-2 bg-gray-200 rounded font-bold">‡§∞‡§¶‡•ç‡§¶</button>
                            <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded font-bold hover:bg-green-700">‡§™‡•á‡§∂ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                        </div>
                    </form>
                </div>
				
			<div id="view-implementation" class="hidden p-6">
    <div class="bg-white rounded-lg shadow-lg border p-4">
        <div class="flex justify-between items-center mb-6 border-b pb-4">
            <h3 class="text-xl font-bold text-gray-700">üìã ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§û‡•ç‡§ö‡§æ‡§≤‡§® ‡§∏‡•Ç‡§ö‡•Ä</h3>
            <div class="relative inline-block text-left">
                <button onclick="toggleImpDropdown()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow-lg hover:bg-blue-700">
                    + ‡§®‡§Ø‡§æ‡§Å ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
                </button>
                <div id="impDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white border rounded-lg shadow-xl z-50">
                    <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 border-b">‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§Æ‡•ç‡§ù‡•å‡§§‡§æ</a>
                    <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">‡§â‡§™‡§≠‡•ã‡§ï‡•ç‡§§‡§æ ‡§∏‡§Æ‡§ø‡§§‡§ø</a>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
        <table class="min-w-full bg-white border-collapse text-left">
             <thead>
                    <tr class="bg-blue-50 text-blue-800 uppercase" style="font-size: 14px;">
                        <th class="px-4 py-3 border">‡§¶‡§∞‡•ç‡§§‡§æ ‡§®‡§Ç.</th>
                        <th class="px-4 py-3 border">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ/‡§Ü‡§Ø‡•ã‡§ú‡§®‡§æ‡§ï‡•ã ‡§®‡§æ‡§Æ</th>
                        <th class="px-4 py-3 border text-center">‡§µ‡§°‡§æ</th>
                        <th class="px-4 py-3 border">‡§∏‡§Æ‡•ç‡§ù‡•å‡§§‡§æ ‡§Æ‡§ø‡§§‡§ø</th>
                        <th class="px-4 py-3 border">‡§∏‡§Æ‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•Å‡§®‡•á ‡§Æ‡§ø‡§§‡§ø</th>
                        <th class="px-4 py-3 border text-right">‡§∏‡§Æ‡•ç‡§ù‡•å‡§§‡§æ ‡§∞‡§ï‡§Æ</th>
                        <th class="px-4 py-3 border text-right">‡§ñ‡§∞‡•ç‡§ö ‡§∞‡§ï‡§Æ</th>
                        <th class="px-4 py-3 border text-right">‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ</th>
                    </tr>
                </thead>
                <tbody id="implementationTableBody" class="text-sm text-gray-700">
                    </tbody>
            </table>
        </div>
	</div>
        </main>
    </div>

    <script>
        const SB_URL = "https://abdlksutjdmuqpiuqjhi.supabase.co";
        const SB_KEY = "sb_publishable_W8_A_dNK4dby9WfaV4Mnsg_NH45bm8e";
        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

        let currentPage = 1;
        let itemsPerPage = 10;

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const texts = document.querySelectorAll('.sidebar-text');
    
    if (sidebar.classList.contains('w-64')) {
        sidebar.classList.replace('w-64', 'w-20');
        texts.forEach(t => t.style.display = 'none'); 
    } else {
        sidebar.classList.replace('w-20', 'w-64');
        texts.forEach(t => t.style.display = 'inline'); 
    }
}

		function toggleImpDropdown() {
			const dropdown = document.getElementById('impDropdown');
				dropdown.classList.toggle('hidden');
		}

        function showView(viewName) {
			console.log("Switching to:", viewName);

    // ‡•ß. ‡§∏‡§¨‡•à ‡§∏‡•á‡§ï‡•ç‡§∏‡§®‡§π‡§∞‡•Ç ‡§≤‡•Å‡§ï‡§æ‡§â‡§®‡•á
    const views = ['view-dashboard', 'view-registration', 'view-implementation'];
    views.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('hidden');
    });

    // ‡•®. ‡§õ‡§æ‡§®‡§ø‡§è‡§ï‡•ã ‡§∏‡•á‡§ï‡•ç‡§∏‡§® ‡§¶‡•á‡§ñ‡§æ‡§â‡§®‡•á
    const activeView = document.getElementById('view-' + viewName);
    if (activeView) {
        activeView.classList.remove('hidden');
    } else {
        console.error("ID ‡§≠‡•á‡§ü‡§ø‡§è‡§®: view-" + viewName);
    }

    // ‡•©. ‡§∏‡§æ‡§á‡§°‡§¨‡§æ‡§∞‡§ï‡•ã ‡§∞‡§ô‡•ç‡§ó ‡§¨‡§¶‡§≤‡•ç‡§®‡•á (‡§á‡§∞‡§∞ ‡§®‡§Ü‡§â‡§®‡•á ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§§‡§∞‡§ø‡§ï‡§æ)
    const navDash = document.getElementById('nav-dashboard');
    const navReg = document.getElementById('nav-reg');
	const navImp = document.getElementById('nav-imp');
    
    if (navDash) navDash.classList.toggle('bg-blue-600', viewName === 'dashboard');
    if (navReg) navReg.classList.toggle('bg-blue-600', viewName === 'registration');
	if (navImp) navImp.classList.toggle('bg-blue-600', viewName === 'implementation');

    // ‡•™. ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§®‡•á
    if (viewName === 'registration') {
        if (typeof loadProjectData === "function") loadProjectData();
    }
	if (viewName === 'implementation') {
		loadImplementationData();
}
}
        async function init() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (user) {
                document.getElementById('userEmail').innerText = user.email;
                fetchDashboardStats();
                loadCharts();
                showView('dashboard');
            } else { window.location.href = "index.html"; }
        }

        async function fetchDashboardStats() {
            const { count } = await supabaseClient.from('projects').select('*', { count: 'exact', head: true });
            document.getElementById('totalCount').innerText = count || 0;
        }

        async function loadProjectData() {
            const tableBody = document.getElementById('projectTableBody');
            tableBody.innerHTML = '<tr><td colspan="6" class="p-4 text-center">‡§≤‡•ã‡§° ‡§π‡•Å‡§Å‡§¶‡•à‡§õ...</td></tr>';
            const searchTerm = document.getElementById('searchProject').value;
            const wardFilter = document.getElementById('wardFilter').value;
            let query = supabaseClient.from('projects').select('*', { count: 'exact' });
            if (searchTerm) { query = query.or(`Yojana_Name.ilike.%${searchTerm}%,Project_ID.ilike.%${searchTerm}%`); }
            if (wardFilter) { query = query.eq('Ward_No', wardFilter); }
            const from = (currentPage - 1) * itemsPerPage;
            const to = from + itemsPerPage - 1;
            const { data: projects, count, error } = await query.range(from, to).order('id', { ascending: true });
            if (!error && projects) {
                tableBody.innerHTML = '';
				
				projects.forEach(p => {
    const userEmail = document.getElementById('userEmail').innerText;
    const isAdmin = (userEmail === 'bkprakash65@gmail.com'); 

    tableBody.innerHTML += `
        <tr class="hover:bg-gray-50 border-b">
            <td class="px-4 py-3 border font-bold">${p.Project_ID || p.id}</td>
            <td class="px-4 py-3 border font-bold text-blue-700">${p.Yojana_Name || '‡§®‡§æ‡§Æ ‡§ñ‡§æ‡§≤‡•Ä'}</td>
            <td class="px-4 py-3 border text-center">${p.Ward_No || '-'}</td>
            <td class="px-4 py-3 border text-right">${(p.Budget || 0).toLocaleString()}</td>
            <td class="px-4 py-3 border text-center text-red-500">‡•¶</td>
            <td class="px-4 py-3 border text-center text-green-600 font-bold">${(p.Budget || 0).toLocaleString()}</td>
            <td class="px-4 py-3 border text-center">
                <div class="flex justify-center space-x-2">
                    ${isAdmin ? `
                        <button onclick="editProject('${p.id}')" class="bg-yellow-500 text-white px-2 py-1 rounded text-xs hover:bg-yellow-600 transition">Edit</button>
                        <button onclick="deleteProject('${p.id}')" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-700 transition">Delete</button>
                    ` : '<span class="text-gray-400 text-xs italic">view only</span>'}
                </div>
            </td>
        </tr>`;
});
                renderPagination(count);
            }
        }

// ‡•ß. ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§û‡•ç‡§ö‡§æ‡§≤‡§®‡§ï‡•ã ‡§°‡•á‡§ü‡§æ ‡§§‡§æ‡§®‡•ç‡§®‡•á ‡§´‡§ô‡•ç‡§∏‡§®
async function loadImplementationData() {
    const tbody = document.getElementById('implementationTableBody');
    if (!tbody) return;
    
    tbody.innerHTML = '<tr><td colspan="8" class="p-4 text-center">‡§≤‡•ã‡§° ‡§π‡•Å‡§Å‡§¶‡•à‡§õ...</td></tr>';

    const { data, error } = await supabaseClient
        .from('projects') 
        .select('*');

    if (error) {
        tbody.innerHTML = '<tr><td colspan="8" class="p-4 text-center text-red-500">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§</td></tr>';
        return;
    }

    tbody.innerHTML = '';
    data.forEach(p => {
        const budget = p.Budget || 0;
        const spent = 0; // ‡§Ö‡§π‡§ø‡§≤‡•á‡§≤‡§æ‡§à ‡§ñ‡§∞‡•ç‡§ö ‡•¶ ‡§∞‡§æ‡§ñ‡§ø‡§è‡§ï‡•ã ‡§õ
        const row = `
            <tr class="border-b hover:bg-gray-50 text-sm">
                <td class="px-4 py-3 border">${p.Project_ID || p.id}</td>
                <td class="px-4 py-3 border font-bold text-blue-700">${p.Yojana_Name || '‡§®‡§æ‡§Æ ‡§ñ‡§æ‡§≤‡•Ä'}</td>
                <td class="px-4 py-3 border text-center">${p.Ward_No || '-'}</td>
                <td class="px-4 py-3 border text-center">-</td>
                <td class="px-4 py-3 border text-center">-</td>
                <td class="px-4 py-3 border text-right">‡§∞‡•Ç. ${budget.toLocaleString()}</td>
                <td class="px-4 py-3 border text-right text-red-600">‡§∞‡•Ç. ${spent.toLocaleString()}</td>
                <td class="px-4 py-3 border text-right font-bold text-green-600">‡§∞‡•Ç. ${(budget - spent).toLocaleString()}</td>
            </tr>`;
        tbody.innerHTML += row;
    });
}

function renderPagination(totalItems) {
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    const paginationDiv = document.getElementById('paginationControls');
    
    if (!totalItems || totalItems <= 0) { 
        paginationDiv.innerHTML = ""; 
        return; 
    }

    // ‡•ß. ‡§¶‡•á‡§¨‡•ç‡§∞‡•á‡§§‡§ø‡§∞: Showing text
    const fromEntry = (currentPage - 1) * itemsPerPage + 1;
    const toEntry = Math.min(currentPage * itemsPerPage, totalItems);
    let infoHtml = `<div class="text-sm text-gray-700">Showing ${fromEntry} to ${toEntry} of ${totalItems} entries</div>`;

    // ‡•®. ‡§¶‡§æ‡§π‡§ø‡§®‡•á‡§§‡§ø‡§∞: Number Buttons (Previous 1 2 ... Next)
    let buttonsHtml = `<div class="flex items-center space-x-1">
        <button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} 
            class="px-3 py-1 border rounded text-sm disabled:opacity-50 bg-white hover:bg-gray-100">Previous</button>`;

    // ‡§™‡•á‡§ú ‡§®‡§Æ‡•ç‡§¨‡§∞‡§π‡§∞‡•Ç ‡§¶‡•á‡§ñ‡§æ‡§â‡§®‡•á ‡§≤‡§ú‡§ø‡§ï (‡•´ ‡§µ‡§ü‡§æ ‡§™‡•á‡§ú ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ß‡•á‡§∞‡•à ‡§≠‡§è ‡§¨‡•Ä‡§ö‡§Æ‡§æ ... ‡§¶‡•á‡§ñ‡§æ‡§â‡§®‡•á)
    for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
            buttonsHtml += `
                <button onclick="goToPage(${i})" 
                    class="px-3 py-1 border rounded text-sm font-semibold ${currentPage === i ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-blue-600 hover:bg-gray-100'}">
                    ${i}
                </button>`;
        } else if (i === currentPage - 2 || i === currentPage + 2) {
            buttonsHtml += `<span class="px-2">...</span>`;
        }
    }

    buttonsHtml += `
        <button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} 
            class="px-3 py-1 border rounded text-sm disabled:opacity-50 bg-white hover:bg-gray-100">Next</button>
    </div>`;

    paginationDiv.innerHTML = infoHtml + buttonsHtml;
}

function goToPage(pageNum) {
    // ‡•ß ‡§≠‡§®‡•ç‡§¶‡§æ ‡§∏‡§æ‡§®‡•ã ‡§™‡•á‡§ú‡§Æ‡§æ ‡§ú‡§æ‡§® ‡§®‡§¶‡§ø‡§®‡•á
    if (pageNum < 1) return; 
    
    // ‡§Ö‡§π‡§ø‡§≤‡•á‡§ï‡•ã ‡§™‡•á‡§ú ‡§®‡§Æ‡•ç‡§¨‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ó‡§∞‡•ç‡§®‡•á
    currentPage = pageNum;
    
    // ‡§°‡§æ‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§®‡•á ‡§´‡§ô‡•ç‡§∏‡§®‡§≤‡§æ‡§à ‡§´‡•á‡§∞‡§ø ‡§¨‡•ã‡§≤‡§æ‡§â‡§®‡•á
    loadProjectData(); 
}
        // Modal Functions
      let editingId = null; // ‡§Ø‡•ã ‡§≤‡§æ‡§á‡§®‡§≤‡•á ‡§ï‡•Å‡§® ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§ö‡•ç‡§Ø‡§æ‡§â‡§®‡•á ‡§π‡•ã ‡§•‡§æ‡§π‡§æ ‡§™‡§æ‡§â‡§Å‡§õ

        function openModal() { 
            document.getElementById('registrationModal').classList.remove('hidden'); 
        }

        function closeModal() {
            document.getElementById('registrationModal').classList.add('hidden');
            editingId = null; // ‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§¶‡§æ ID ‡§∞‡§ø‡§∏‡•á‡§ü ‡§ó‡§∞‡•ç‡§®‡•á
            clearForm();
        }
        function clearForm() {
            document.getElementById('projectForm').reset();
            editingId = null;
        }

        // Edit ‡§¨‡§ü‡§® ‡§•‡§ø‡§ö‡•ç‡§¶‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§´‡§æ‡§∞‡§Æ‡§Æ‡§æ ‡§≤‡•ç‡§Ø‡§æ‡§â‡§®‡•á ‡§´‡§ô‡•ç‡§∏‡§®
        async function editProject(id) {
            const { data, error } = await supabaseClient.from('projects').select('*').eq('id', id).single();
            if (error) {
                alert("‡§°‡§æ‡§ü‡§æ ‡§≠‡•á‡§ü‡§ø‡§è‡§®!");
            } else {
                editingId = id; // ID ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡§æ‡§ñ‡•ç‡§®‡•á
                document.getElementById('form_Yojana_Name').value = data.Yojana_Name;
                document.getElementById('form_Ward_No').value = data.Ward_No;
                document.getElementById('form_Budget').value = data.Budget;
                document.getElementById('form_FY').value = data.Fiscal_Year;
                document.getElementById('form_Sector').value = data.Sector;
                document.getElementById('form_Type').value = data.Allocation_Type;
                document.getElementById('form_Location').value = data.Location;
                openModal();
            }
        }

        // ‡§∏‡•á‡§≠ ‡§ó‡§∞‡•ç‡§¶‡§æ (‡§®‡§Ø‡§æ‡§Å ‡§µ‡§æ ‡§Ö‡§™‡§°‡•á‡§ü) ‡§¶‡•Å‡§µ‡•à ‡§ö‡•á‡§ï ‡§ó‡§∞‡•ç‡§®‡•á
  	
        // ‡•ß. ‡§´‡§æ‡§∞‡§Æ ‡§ñ‡•ã‡§≤‡•ç‡§®‡•á (‡§®‡§Ø‡§æ‡§Å ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡§¨‡§ü‡§®)
        function openModal() { 
            document.getElementById('registrationModal').classList.remove('hidden'); 
        }

        // ‡•®. ‡§™‡§™-‡§Ö‡§™ ‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•á ("x" ‡§¨‡§ü‡§® ‡§∞ ‡§™‡•á‡§∂ ‡§ó‡§∞‡•á‡§™‡§õ‡§ø)
        function closeModal() {
            document.getElementById('registrationModal').classList.add('hidden');
        }

        // ‡•©. ‡§∞‡§¶‡•ç‡§¶ ‡§•‡§ø‡§ö‡•ç‡§¶‡§æ: ‡§™‡§™-‡§Ö‡§™ ‡§¨‡§®‡•ç‡§¶ ‡§®‡§ó‡§∞‡•ç‡§®‡•á, ‡§ï‡•á‡§µ‡§≤ ‡§≠‡§ø‡§§‡•ç‡§∞‡§ï‡§æ ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ñ‡§æ‡§≤‡•Ä ‡§ó‡§∞‡•ç‡§®‡•á
        function clearForm() {
            const form = document.getElementById('projectForm');
            form.reset(); // ‡§∏‡§¨‡•à ‡§ü‡§æ‡§á‡§™ ‡§ó‡§∞‡•á‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§Æ‡•á‡§ü‡•ç‡§õ
        }
// ‡•™. ‡§™‡•á‡§∂ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡§•‡§ø‡§ö‡•ç‡§¶‡§æ: ‡§°‡§æ‡§ü‡§æ‡§¨‡•á‡§∏ ‡§∏‡•á‡§≠ ‡§ó‡§∞‡•ç‡§®‡•á ‡§∞ ‡§™‡§™-‡§Ö‡§™ ‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•á
        document.getElementById('projectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
const formData = {
    Project_ID: "SHIV-82/83-" + Math.floor(1000 + Math.random() * 9000), 
    Yojana_Name: document.getElementById('form_Yojana_Name').value,
    Ward_No: parseInt(document.getElementById('form_Ward_No').value) || 0,
    Budget: parseFloat(document.getElementById('form_Budget').value) || 0,
    Fiscal_Year: document.getElementById('form_FY').value,
    Sector: document.getElementById('form_Sector').value,
    Allocation_Type: document.getElementById('form_Type').value,
    Location: document.getElementById('form_Location').value,
    // ‡§Ø‡•ã ‡§§‡§≤‡§ï‡•ã ‡§≤‡§æ‡§á‡§® ‡§•‡§™‡•á‡§™‡§õ‡§ø ‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§§‡•ç‡§Ø‡•ã ‡§Æ‡•ç‡§Ø‡§æ‡§∏‡•á‡§ú ‡§π‡§∞‡§æ‡§â‡§Å‡§õ
    Branch: "‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∂‡§æ‡§ñ‡§æ" 
};
            const { error } = await supabaseClient.from('projects').insert([formData]);

            if (error) {
                alert("‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: " + error.message);
            } else {
                alert("‡§°‡§æ‡§ü‡§æ‡§¨‡•á‡§∏ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≠‡§Ø‡•ã!");
                clearForm(); // ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§Æ‡•á‡§ü‡•ç‡§®‡•á
                closeModal(); // ‡§™‡§™-‡§Ö‡§™ ‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•á
                loadProjectData(); // ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ ‡§Ö‡§™‡§°‡•á‡§ü
                fetchDashboardStats(); // ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§Ö‡§™‡§°‡•á‡§ü
            }
        });
        // --- ‡§Ø‡§π‡§æ‡§Å ‡§∏‡§Æ‡•ç‡§Æ ---        
        function loadCharts() {
            new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: { labels: ['‡§∂‡•ç‡§∞‡§æ‡§µ‡§£', '‡§≠‡§¶‡•å', '‡§Ö‡§∏‡•ã‡§ú', '‡§ï‡§æ‡§∞‡•ç‡§§‡§ø‡§ï', '‡§Æ‡§Ç‡§∏‡§ø‡§∞'], datasets: [{ label: '‡§∏‡§Æ‡•ç‡§ù‡•å‡§§‡§æ', data: [5, 12, 18, 25, 40], backgroundColor: '#3b82f6' }] }
            });
            new Chart(document.getElementById('pieChart'), {
                type: 'doughnut',
                data: { labels: ['‡§∏‡§Æ‡§ø‡§§‡§ø', '‡§ï‡§Æ‡•ç‡§™‡§®‡•Ä', '‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø'], datasets: [{ data: [60, 5, 35], backgroundColor: ['#8b5cf6', '#3b82f6', '#f59e0b'] }] }
            });
        }
        async function logout() { await supabaseClient.auth.signOut(); window.location.href = "index.html"; }
        // ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§π‡§ü‡§æ‡§â‡§®‡•á (Delete) ‡§´‡§ô‡•ç‡§∏‡§®
        async function deleteProject(id) {
            if (confirm("‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Å ‡§™‡§ï‡•ç‡§ï‡§æ ‡§Ø‡•ã ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§π‡§ü‡§æ‡§â‡§® ‡§ö‡§æ‡§π‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ?")) {
                const { error } = await supabaseClient
                    .from('projects')
                    .delete()
                    .eq('id', id);

                if (error) {
                    alert("‡§π‡§ü‡§æ‡§â‡§® ‡§∏‡§ï‡§ø‡§è‡§®: " + error.message);
                } else {
                    alert("‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§π‡§ü‡§æ‡§á‡§Ø‡•ã!");
                    loadProjectData(); // ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ ‡§§‡•Å‡§∞‡•Å‡§®‡•ç‡§§‡•à ‡§Ö‡§™‡§°‡•á‡§ü ‡§ó‡§∞‡•ç‡§®
                    fetchDashboardStats(); // ‡§°‡•ç‡§Ø‡§æ‡§∏‡§¨‡•ã‡§∞‡•ç‡§°‡§ï‡•ã ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ó‡§∞‡•ç‡§®
                }
            }
        }

        async function logout() { await supabaseClient.auth.signOut(); window.location.href = "index.html"; }
// ‡§Æ‡•ã‡§°‡§≤‡§≤‡§æ‡§à ‡§Æ‡§æ‡§â‡§∏‡§≤‡•á ‡§∏‡§Æ‡§æ‡§§‡•á‡§∞ ‡§∏‡§æ‡§∞‡•ç‡§®‡•á (Drag and Drop) ‡§ï‡•ã‡§°
const modalContainer = document.querySelector('#registrationModal > div');
const modalHeader = document.getElementById('modalHeader');
let isDragging = false, offsetStartX, offsetStartY;

modalHeader.onmousedown = (e) => {
    isDragging = true;
    offsetStartX = e.clientX - modalContainer.offsetLeft;
    offsetStartY = e.clientY - modalContainer.offsetTop;
    modalHeader.style.cursor = 'grabbing';
};

document.onmousemove = (e) => {
    if (!isDragging) return;
    // ‡§Æ‡•ã‡§°‡§≤‡§≤‡§æ‡§à ‡§¨‡§ø‡§ö‡§¨‡§æ‡§ü ‡§π‡§ü‡§æ‡§è‡§∞ ‡§Æ‡§æ‡§â‡§∏‡§ï‡•ã ‡§ö‡§æ‡§≤ ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§∏‡§æ‡§∞‡•ç‡§®‡•á
    modalContainer.style.position = 'absolute';
    modalContainer.style.margin = '0';
    modalContainer.style.left = (e.clientX - offsetStartX) + 'px';
    modalContainer.style.top = (e.clientY - offsetStartY) + 'px';
};

document.onmouseup = () => {
    isDragging = false;
    modalHeader.style.cursor = 'move';
};

function updateEntries() {
    // ‡§°‡•ç‡§∞‡§™‡§°‡§æ‡§â‡§®‡§¨‡§æ‡§ü ‡§õ‡§æ‡§®‡§ø‡§è‡§ï‡•ã ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§≤‡§ø‡§®‡•á
    itemsPerPage = parseInt(document.getElementById("entriesPerPage").value);
    
    // ‡§™‡•á‡§ú‡§≤‡§æ‡§à ‡•ß ‡§Æ‡§æ ‡§´‡§∞‡•ç‡§ï‡§æ‡§â‡§®‡•á
    currentPage = 1; 
    
    // ‡§°‡§æ‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§®‡•á
    loadProjectData();
}
	
	init();
    // ‡•ß. ‡§´‡§∞‡•ç‡§Æ ‡§ñ‡•ã‡§≤‡•ç‡§®‡•á ‡§´‡§ô‡•ç‡§∏‡§®
function openOperationModal(projectId) {
    document.getElementById('formationProjectId').value = projectId;
    document.getElementById('formationModal').classList.remove('hidden');
}

// ‡•®. ‡§´‡§∞‡•ç‡§Æ ‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•á ‡§´‡§ô‡•ç‡§∏‡§®
function closeFormationModal() {
    document.getElementById('formationModal').classList.add('hidden');
    document.getElementById('formationForm').reset();
}

// ‡•©. ‡§°‡§æ‡§ü‡§æ ‡§∏‡•á‡§≠ ‡§ó‡§∞‡•ç‡§®‡•á (Submit) ‡§´‡§ô‡•ç‡§∏‡§®
document.getElementById('formationForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const projectId = document.getElementById('formationProjectId').value;
    
    // ‡§ö‡•á‡§ï‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§ó‡§∞‡•ç‡§®‡•á
    const checklist = [];
    document.querySelectorAll('.checklist-item:checked').forEach(item => {
        checklist.push(item.value);
    });

    // ‡§°‡§æ‡§ü‡§æ ‡§§‡§Ø‡§æ‡§∞ ‡§™‡§æ‡§∞‡•ç‡§®‡•á
    const updateData = {
        formation_date: document.getElementById('formation_date').value,
        address: document.getElementById('formation_address').value,
        contact_no: document.getElementById('formation_contact').value,
        execution_type: '‡§â‡§™‡§≠‡•ã‡§ï‡•ç‡§§‡§æ ‡§∏‡§Æ‡§ø‡§§‡§ø',
        
        // ‡§™‡§¶‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ JSON ‡§¢‡§æ‡§Å‡§ö‡§æ‡§Æ‡§æ
        chairman_info: {
            name: document.getElementById('chairman_name').value,
            cit_no: document.getElementById('chairman_cit').value,
            gender: document.getElementById('chairman_gender').value,
            father: document.getElementById('chairman_father').value,
            phone: document.getElementById('chairman_phone').value
        },
        secretary_info: {
            name: document.getElementById('secretary_name').value,
            cit_no: document.getElementById('secretary_cit').value,
            gender: document.getElementById('secretary_gender').value,
            father: document.getElementById('secretary_father').value,
            phone: document.getElementById('secretary_phone').value
        },
        treasurer_info: {
            name: document.getElementById('treasurer_name').value,
            cit_no: document.getElementById('treasurer_cit').value,
            gender: document.getElementById('treasurer_gender').value,
            father: document.getElementById('treasurer_father').value,
            phone: document.getElementById('treasurer_phone').value
        },
        formation_checklist: checklist
    };

    try {
        const { error } = await _supabase
            .from('projects')
            .update(updateData)
            .eq('id', projectId);

        if (error) throw error;

        alert('‡§â‡§™‡§≠‡•ã‡§ï‡•ç‡§§‡§æ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§´‡§≤‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ó‡§∞‡§ø‡§Ø‡•ã!');
        closeFormationModal();
    } catch (err) {
        console.error(err);
        alert('‡§°‡§æ‡§ü‡§æ ‡§∏‡•á‡§≠ ‡§ó‡§∞‡•ç‡§¶‡§æ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§Ø‡•ã: ' + err.message);
    }
});
	
	</script>
	<div id="formationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto pt-10">
    <div class="bg-white w-11/12 max-w-5xl mx-auto rounded-lg shadow-xl mb-10 border-t-4 border-blue-600">
        <div class="p-4 border-b flex justify-between items-center bg-gray-50">
            <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                üìã ‡§®‡§Ø‡§æ‡§Å ‡§â‡§™‡§≠‡•ã‡§ï‡•ç‡§§‡§æ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§ó‡§†‡§® ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
            </h3>
            <button onclick="closeFormationModal()" class="text-2xl text-gray-500 hover:text-red-500">&times;</button>
        </div>

        <div class="p-6">
            <form id="formationForm" class="space-y-6">
                <input type="hidden" id="formationProjectId">
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-bold mb-1">‡§ó‡§†‡§® ‡§Æ‡§ø‡§§‡§ø</label>
                        <input type="date" id="formation_date" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-400 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">‡§†‡•á‡§ó‡§æ‡§®‡§æ (‡§∏‡•ç‡§•‡§æ‡§®)</label>
                        <input type="text" id="formation_address" placeholder="‡§µ‡§°‡§æ ‡§®‡§Ç. ‡§∞ ‡§ó‡§æ‡§â‡§Å‡§ï‡•ã ‡§®‡§æ‡§Æ" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-400 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç.</label>
                        <input type="text" id="formation_contact" placeholder="‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï ‡§´‡•ã‡§® ‡§®‡§Æ‡•ç‡§¨‡§∞" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-400 outline-none">
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100 text-sm">
                                <th class="border p-2 w-32">‡§™‡§¶</th>
                                <th class="border p-2">‡§®‡§æ‡§Æ ‡§•‡§∞</th>
                                <th class="border p-2">‡§®‡§æ‡§ó‡§∞‡§ø‡§ï‡§§‡§æ ‡§®‡§Ç.</th>
                                <th class="border p-2 w-24">‡§≤‡§ø‡§ô‡•ç‡§ó</th>
                                <th class="border p-2">‡§¨‡•Å‡§µ‡§æ/‡§™‡§§‡§ø‡§ï‡•ã ‡§®‡§æ‡§Æ</th>
                                <th class="border p-2">‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç.</th>
                            </tr>
                        </thead>
                        <tbody id="memberRows">
                            <tr>
                                <td class="border p-2 font-bold bg-gray-50">‡§Ö‡§ß‡•ç‡§Ø‡§ï‡•ç‡§∑</td>
                                <td class="border p-1"><input type="text" id="chairman_name" class="w-full p-1 outline-none"></td>
                                <td class="border p-1"><input type="text" id="chairman_cit" class="w-full p-1 outline-none"></td>
                                <td class="border p-1">
                                    <select id="chairman_gender" class="w-full p-1">
                                        <option value="‡§™‡•Å‡§∞‡•Å‡§∑">‡§™‡•Å‡§∞‡•Å‡§∑</option>
                                        <option value="‡§Æ‡§π‡§ø‡§≤‡§æ">‡§Æ‡§π‡§ø‡§≤‡§æ</option>
                                        <option value="‡§Ö‡§®‡•ç‡§Ø">‡§Ö‡§®‡•ç‡§Ø</option>
                                    </select>
                                </td>
                                <td class="border p-1"><input type="text" id="chairman_father" class="w-full p-1 outline-none"></td>
                                <td class="border p-1"><input type="text" id="chairman_phone" class="w-full p-1 outline-none"></td>
                            </tr>
                            <tr>
                                <td class="border p-2 font-bold bg-gray-50">‡§∏‡§ö‡§ø‡§µ</td>
                                <td class="border p-1"><input type="text" id="secretary_name" class="w-full p-1 outline-none"></td>
                                <td class="border p-1"><input type="text" id="secretary_cit" class="w-full p-1 outline-none"></td>
                                <td class="border p-1">
                                    <select id="secretary_gender" class="w-full p-1"><option value="‡§™‡•Å‡§∞‡•Å‡§∑">‡§™‡•Å‡§∞‡•Å‡§∑</option><option value="‡§Æ‡§π‡§ø‡§≤‡§æ" selected>‡§Æ‡§π‡§ø‡§≤‡§æ</option></select>
                                </td>
                                <td class="border p-1"><input type="text" id="secretary_father" class="w-full p-1 outline-none"></td>
                                <td class="border p-1"><input type="text" id="secretary_phone" class="w-full p-1 outline-none"></td>
                            </tr>
                            <tr>
                                <td class="border p-2 font-bold bg-gray-50">‡§ï‡•ã‡§∑‡§æ‡§ß‡•ç‡§Ø‡§ï‡•ç‡§∑</td>
                                <td class="border p-1"><input type="text" id="treasurer_name" class="w-full p-1 outline-none"></td>
                                <td class="border p-1"><input type="text" id="treasurer_cit" class="w-full p-1 outline-none"></td>
                                <td class="border p-1">
                                    <select id="treasurer_gender" class="w-full p-1"><option value="‡§Æ‡§π‡§ø‡§≤‡§æ" selected>‡§Æ‡§π‡§ø‡§≤‡§æ</option><option value="‡§™‡•Å‡§∞‡•Å‡§∑">‡§™‡•Å‡§∞‡•Å‡§∑</option></select>
                                </td>
                                <td class="border p-1"><input type="text" id="treasurer_father" class="w-full p-1 outline-none"></td>
                                <td class="border p-1"><input type="text" id="treasurer_phone" class="w-full p-1 outline-none"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <h4 class="font-bold text-blue-800 mb-2">‡§ö‡•á‡§ï ‡§≤‡§ø‡§∏‡•ç‡§ü (‡§∏‡§Ç‡§≤‡§ó‡•ç‡§® ‡§ï‡§æ‡§ó‡§ú‡§æ‡§§‡§π‡§∞‡•Ç)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        <label class="flex items-center gap-2"><input type="checkbox" class="checklist-item" value="‡§≠‡•á‡§≤‡§æ‡§ï‡•ã ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø"> ‡§≠‡•á‡§≤‡§æ‡§ï‡•ã ‡§Æ‡§æ‡§á‡§®‡•ç‡§Ø‡•Å‡§ü ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§™‡•ç‡§∞‡§§‡§ø‡§≤‡§ø‡§™‡§ø</label>
                        <label class="flex items-center gap-2"><input type="checkbox" class="checklist-item" value="‡§®‡§æ‡§ó‡§∞‡§ø‡§ï‡§§‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§≤‡§ø‡§™‡§ø"> ‡§™‡§¶‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä‡§ï‡•ã ‡§®‡§æ‡§ó‡§∞‡§ø‡§ï‡§§‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§≤‡§ø‡§™‡§ø</label>
                        <label class="flex items-center gap-2"><input type="checkbox" class="checklist-item" value="‡§µ‡§°‡§æ ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∏"> ‡§µ‡§°‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§ï‡•ã ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∏ ‡§™‡§§‡•ç‡§∞</label>
                        <label class="flex items-center gap-2"><input type="checkbox" class="checklist-item" value="‡§Æ‡§π‡§ø‡§≤‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§®‡§ø‡§ß‡§ø‡§§‡•ç‡§µ"> ‡•©‡•©% ‡§Æ‡§π‡§ø‡§≤‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§®‡§ø‡§ß‡§ø‡§§‡•ç‡§µ ‡§™‡•Å‡§ó‡•á‡§ï‡•ã</label>
                    </div>
                </div>

                <div class="flex justify-end gap-3 border-t pt-4">
                    <button type="button" onclick="closeFormationModal()" class="px-6 py-2 bg-gray-200 rounded hover:bg-gray-300">‡§∞‡§¶‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-md flex items-center gap-2">
                        üíæ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://nepali-datetime-picker.s3.ap-south-1.amazonaws.com/nepali.datepicker.v4.0.1.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // '‡§Æ‡§ø‡§§‡§ø ‡§¶‡•á‡§ñ‡§ø' ‡§∏‡•Å‡§ö‡§æ‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•á
        var fromEl = document.getElementById("nepali-datepicker-from");
        if (fromEl) {
            fromEl.nepaliDatePicker({
                ndpYear: true,
                ndpMonth: true,
                readOnlyInput: true
            });
        }

        // '‡§Æ‡§ø‡§§‡§ø ‡§∏‡§Æ‡•ç‡§Æ' ‡§∏‡•Å‡§ö‡§æ‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•á
        var toEl = document.getElementById("nepali-datepicker-to");
        if (toEl) {
            toEl.nepaliDatePicker({
                ndpYear: true,
                ndpMonth: true,
                readOnlyInput: true
            });
        }
    });

// ‡•ß. Excel Download ‡§ó‡§∞‡•ç‡§®‡•á ‡§´‡§ô‡•ç‡§∏‡§®
function exportToExcel() {
    var table = document.getElementById("projectTable");
    if (!table) {
        alert("‡§ü‡•á‡§¨‡§≤ ‡§´‡•á‡§≤‡§æ ‡§™‡§∞‡•á‡§®!");
        return;
    }

    // "‡§ï‡§æ‡§∞‡•ç‡§Ø" (Action) ‡§ï‡•ã‡§≤‡§Æ ‡§π‡§ü‡§æ‡§â‡§® ‡§ü‡•á‡§¨‡§≤ ‡§ï‡§™‡•Ä ‡§ó‡§∞‡•ç‡§®‡•á
    var cloneTable = table.cloneNode(true);
    var rows = cloneTable.rows;
    for (var i = 0; i < rows.length; i++) {
        rows[i].deleteCell(-1); // ‡§Ö‡§®‡•ç‡§§‡§ø‡§Æ ‡§ï‡•ã‡§≤‡§Æ ‡§π‡§ü‡§æ‡§â‡§®‡•á
    }

    var html = cloneTable.outerHTML;
    // ‡§®‡•á‡§™‡§æ‡§≤‡•Ä ‡§´‡§®‡•ç‡§ü ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø UTF-8 ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§õ
    var blobData = '<meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8">' + html;
    var blob = new Blob([blobData], { type: 'application/vnd.ms-excel' });
    var url = window.URL.createObjectURL(blob);
    var link = document.createElement('a');
    
    link.download = '‡§Ø‡•ã‡§ú‡§®‡§æ_‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü.xls';
    link.href = url;
    link.click();
}

// ‡•®. ‡§§‡§™‡§æ‡§à‡§Å‡§ï‡•à ‡§∏‡§æ‡§µ‡§ø‡§ï‡§ï‡•ã Print ‡§ó‡§∞‡•ç‡§®‡•á ‡§´‡§ô‡•ç‡§∏‡§®
function printData() {
    var divToPrint = document.getElementById("projectTable").cloneNode(true);
    var allRows = divToPrint.rows;
    for (var i = 0; i < allRows.length; i++) {
        allRows[i].deleteCell(-1);
    }

    var newWin = window.open("");
    newWin.document.write(`
        <html>
        <head>
            <title>‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</title>
            <style>
                body { font-family: 'Kalimati', 'Arial', sans-serif; text-align: center; padding: 20px; }
                .header { position: relative; margin-bottom: 20px; }
                .logo { position: absolute; left: 0; top: 0; width: 80px; }
                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                th, td { border: 1px solid black; padding: 8px; text-align: left; font-size: 14px; }
                th { background-color: #f2f2f2; text-align: center; }
                .footer { margin-top: 50px; text-align: right; font-size: 16px; }
            </style>
        </head>
        <body>
            <div class="header">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/23/Emblem_of_Nepal.svg" class="logo">
                <h2 style="margin:0;">‡§∂‡§ø‡§µ‡§∞‡§æ‡§ú ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ</h2>
                <h3 style="margin:5px 0;">‡§®‡§ó‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§™‡§æ‡§≤‡§ø‡§ï‡§æ‡§ï‡•ã ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø</h3>
                <p style="margin:0;">‡§ö‡§®‡•ç‡§¶‡•ç‡§∞‡•å‡§ü‡§æ, ‡§ï‡§™‡§ø‡§≤‡§µ‡§∏‡•ç‡§§‡•Å<br>‡§≤‡•Å‡§Æ‡•ç‡§¨‡§ø‡§®‡•Ä ‡§™‡•ç‡§∞‡§¶‡•á‡§∂, ‡§®‡•á‡§™‡§æ‡§≤</p>
                <hr>
                <h4>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ/‡§Ü‡§Ø‡•ã‡§ú‡§®‡§æ/‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ï‡§≤‡§æ‡§™‡§ï‡•ã ‡§µ‡§ø‡§µ‡§∞‡§£</h4>
            </div>
            ${divToPrint.outerHTML}
            <div class="footer">
                <p>...........................................</p>
            </div>
        </body>
        </html>
    `);

    newWin.document.close();
    setTimeout(function() {
        newWin.print();
        newWin.close();
    }, 500);
}
$(document).ready(function() {
    // ‡§Ü‡§ß‡§æ ‡§∏‡•á‡§ï‡•á‡§®‡•ç‡§° ‡§¢‡§ø‡§≤‡•ã ‡§ó‡§∞‡§ø ‡§ö‡§≤‡§æ‡§â‡§®‡•á ‡§§‡§æ‡§ï‡§ø ‡§∏‡§¨‡•à ‡§´‡§æ‡§á‡§≤ ‡§≤‡•ã‡§° ‡§π‡•Å‡§®‡•ç
    setTimeout(function() {
        if (typeof $.fn.nepaliDatePicker !== 'undefined') {
            $('#nepali-datepicker-from, #nepali-datepicker-to').nepaliDatePicker({
                ndpYear: true,
                ndpMonth: true,
                readOnlyInput: true
            });
            console.log("Calendar is now Active!");
        } else {
            console.error("Nepali Datepicker Library not found!");
        }
    }, 500);
});
</script>
</body>
</html>

